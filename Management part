from binance.client import Client
import time
from datetime import datetime
from datetime import timedelta
from pytz import timezone

def managment():
    # Set all digital currencies data
    """
    DIGITAL_CURRENCY_1MINUTE
    DIGITAL_CURRENCY_3MINUTE
    DIGITAL_CURRENCY_5MINUTE
    DIGITAL_CURRENCY_15MINUTE
    DIGITAL_CURRENCY_30MINUTE
    DIGITAL_CURRENCY_1HOUR
    DIGITAL_CURRENCY_2HOUR
    DIGITAL_CURRENCY_4HOUR
    DIGITAL_CURRENCY_6HOUR
    DIGITAL_CURRENCY_8HOUR
    DIGITAL_CURRENCY_1DAY
    """

    current_time = datetime.now(timezone('Africa/Accra'))
    desired_time_1Minute = current_time + (timedelta(minutes=1))
    desired_time_3Minute = current_time + (timedelta(minutes=3))
    desired_time_5Minute = current_time + (timedelta(minutes=5))
    desired_time_15Minute = current_time + (timedelta(minutes=15))
    desired_time_30Minute = current_time + (timedelta(minutes=30))
    desired_time_1Hour = current_time + (timedelta(hours=1))
    desired_time_2Hour = current_time + (timedelta(hours=2))
    desired_time_4Hour = current_time + (timedelta(hours=4))
    desired_time_6Hour = current_time + (timedelta(hours=6))
    desired_time_8Hour = current_time + (timedelta(hours=8))
    desired_time_1Day = current_time + (timedelta(days=1))

    print(general_dict)

    while (True):
        try:
            current_time = datetime.now(timezone('Africa/Accra'))
            if (current_time.minute == desired_time_1Minute.minute):
                desired_time_1Minute = current_time + (timedelta(minutes=1))
                for dc_object in digital_currensies_list:
                    if dc_object.time_frame == '1MINUTE':
                        dc_object.check()
                        print("1min main check")
                for layer_object in layer_confirmation_list:
                    if layer_object.time_frame == '1MINUTE':
                        layer_object.update_layer()
                        print("1min layer check")
            if (current_time.minute == desired_time_3Minute.minute):
                desired_time_3Minute = current_time + (timedelta(minutes=3))
                for dc_object in digital_currensies_list:
                    if dc_object.time_frame == '3MINUTE':
                        dc_object.check()
                        print("3min main check")
                for layer_object in layer_confirmation_list:
                    if layer_object.time_frame == '3MINUTE':
                        layer_object.update_layer()
                        print("3min layer check")
            if (current_time.minute == desired_time_5Minute.minute):
                desired_time_5Minute = current_time + (timedelta(minutes=5))
                for dc_object in digital_currensies_list:
                    if dc_object.time_frame == '5MINUTE':
                        dc_object.check()
                        print("5min layer check")
                for layer_object in layer_confirmation_list:
                    if layer_object.time_frame == '5MINUTE':
                        layer_object.update_layer()
                        print("5min layer check")
            if (current_time.minute == desired_time_15Minute.minute):
                desired_time_15Minute = current_time + (timedelta(minutes=15))
                for dc_object in digital_currensies_list:
                    if dc_object.time_frame == '15MINUTE':
                        dc_object.check()
                for layer_object in layer_confirmation_list:
                    if layer_object.time_frame == '15MINUTE':
                        layer_object.update_layer()
            if (current_time.minute == desired_time_30Minute.minute):
                desired_time_30Minute = current_time + (timedelta(minutes=30))
                for dc_object in digital_currensies_list:
                    if dc_object.time_frame == '30MINUTE':
                        dc_object.check()
                for layer_object in layer_confirmation_list:
                    if layer_object.time_frame == '30MINUTE':
                        layer_object.update_layer()
            if (current_time.hour == desired_time_1Hour.hour):
                desired_time_1Hour = current_time + (timedelta(hours=1))
                for dc_object in digital_currensies_list:
                    if dc_object.time_frame == '1HOUR':
                        dc_object.check()
                for layer_object in layer_confirmation_list:
                    if layer_object.time_frame == '1HOUR':
                        layer_object.update_layer()
            if (current_time.hour == desired_time_2Hour.hour):
                desired_time_2Hour = current_time + (timedelta(hours=2))
                for dc_object in digital_currensies_list:
                    if dc_object.time_frame == '2HOUR':
                        dc_object.check()
                for layer_object in layer_confirmation_list:
                    if layer_object.time_frame == '2HOUR':
                        layer_object.update_layer()
            if (current_time.hour == desired_time_4Hour.hour):
                desired_time_4Hour = current_time + (timedelta(hours=4))
                for dc_object in digital_currensies_list:
                    if dc_object.time_frame == '4HOUR':
                        dc_object.check()
                for layer_object in layer_confirmation_list:
                    if layer_object.time_frame == '4HOUR':
                        layer_object.update_layer()
            if (current_time.hour == desired_time_6Hour.hour):
                desired_time_6Hour = current_time + (timedelta(hours=6))
                for dc_object in digital_currensies_list:
                    if dc_object.time_frame == '6HOUR':
                        dc_object.check()
                for layer_object in layer_confirmation_list:
                    if layer_object.time_frame == '6HOUR':
                        layer_object.update_layer()
            if (current_time.hour == desired_time_8Hour.hour):
                desired_time_8Hour = current_time + (timedelta(hours=8))
                for dc_object in digital_currensies_list:
                    if dc_object.time_frame == '8HOUR':
                        dc_object.check()
                for layer_object in layer_confirmation_list:
                    if layer_object.time_frame == '8HOUR':
                        layer_object.update_layer()
            if (current_time.day == desired_time_1Day.day):
                desired_time_1Day = current_time + (timedelta(days=1))
                for dc_object in digital_currensies_list:
                    if dc_object.time_frame == '1DAY':
                        dc_object.check()
                for layer_object in layer_confirmation_list:
                    if layer_object.time_frame == '1DAY':
                        layer_object.update_layer()

            for dc_object in digital_currensies_list:
                dc_object.trade()

            time.sleep(1)

        except Exception as error:
            EMAIL_ACCOUNT.send_email(subject="Connection time out!",
                                my_message=str(error))
